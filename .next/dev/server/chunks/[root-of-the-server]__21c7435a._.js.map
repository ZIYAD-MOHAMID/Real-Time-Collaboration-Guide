{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///E:/wark/Next.graphQL/nextTyar/src/lib/graphql/schema.ts"],"sourcesContent":["import { parse } from 'graphql';\r\n\r\nconst schemaSDL = `\r\n  scalar Bytes\r\n\r\n  type User {\r\n    id: String!\r\n    email: String!\r\n    name: String\r\n    image: String\r\n  }\r\n\r\n  type Document {\r\n    id: String!\r\n    title: String!\r\n    content: Bytes\r\n    type: String!\r\n    createdAt: DateTime!\r\n    updatedAt: DateTime!\r\n    owner: User!\r\n    access: [DocumentAccess!]!\r\n  }\r\n\r\n  type DocumentAccess {\r\n    id: String!\r\n    user: User!\r\n    document: Document!\r\n    permission: PermissionType!\r\n    grantedAt: DateTime!\r\n  }\r\n\r\n  enum PermissionType {\r\n    VIEWER\r\n    EDITOR\r\n    ADMIN\r\n  }\r\n\r\n  type Query {\r\n    documents: [Document!]!\r\n    document(id: String!): Document\r\n    myDocuments: [Document!]!\r\n    sharedDocuments: [Document!]!\r\n  }\r\n\r\n  type Mutation {\r\n    createDocument(title: String!, type: String!): Document!\r\n    updateDocument(id: String!, title: String, content: Bytes): Document!\r\n    deleteDocument(id: String!): Boolean!\r\n    shareDocument(\r\n      documentId: String!\r\n      userId: String!\r\n      permission: PermissionType!\r\n    ): DocumentAccess!\r\n    revokeAccess(documentId: String!, userId: String!): Boolean!\r\n  }\r\n\r\n  type Subscription {\r\n    documentUpdated(documentId: String!): Document!\r\n    documentShared(documentId: String!): DocumentAccess!\r\n  }\r\n\r\n  scalar DateTime\r\n`;\r\n\r\nexport const typeDefs = parse(schemaSDL);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,YAAY,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DnB,CAAC;AAEM,MAAM,WAAW,IAAA,yJAAK,EAAC"}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///E:/wark/Next.graphQL/nextTyar/src/lib/graphql/resolvers.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\nimport { PubSub } from \"graphql-subscriptions\";\r\nimport { GraphQLScalarType } from \"graphql\";\r\n\r\nconst pubsub = new PubSub();\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nconst fetchMyDocuments = async (_: any, __: any, context: any) => {\r\n  console.log(\"=== myDocuments called ===\");\r\n  console.log(\"Context received:\", context);\r\n  console.log(\"User in context:\", context?.user);\r\n\r\n  // TEMPORARY: Allow document listing for testing\r\n  if (!context?.user) {\r\n    console.log(\"No user in context, returning documents for default user\");\r\n    const defaultUserId = \"cmk1q6rlz00005m8ivwcxc5cy\"; // Your user ID\r\n\r\n    const documents = await prisma.document.findMany({\r\n      where: { ownerId: defaultUserId },\r\n      include: {\r\n        owner: true,\r\n        access: { include: { user: true } },\r\n      },\r\n      orderBy: { updatedAt: \"desc\" },\r\n    });\r\n\r\n    return documents.map((doc) => ({\r\n      ...doc,\r\n      access: doc.access || [],\r\n    }));\r\n  }\r\n\r\n  console.log(\"Fetching documents for user:\", context.user.id);\r\n\r\n  const documents = await prisma.document.findMany({\r\n    where: { ownerId: context.user.id },\r\n    include: {\r\n      owner: true,\r\n      access: { include: { user: true } },\r\n    },\r\n    orderBy: { updatedAt: \"desc\" },\r\n  });\r\n  return documents.map((doc) => ({\r\n    ...doc,\r\n    access: doc.access || [],\r\n  }));\r\n};\r\nexport const resolvers = {\r\n  Bytes: new GraphQLScalarType({\r\n    name: 'Bytes',\r\n    description: 'Byte array scalar type',\r\n    serialize(value: any) {\r\n      if (Buffer.isBuffer(value)) {\r\n        return value;\r\n      }\r\n      if (value instanceof Uint8Array) {\r\n        return Buffer.from(value);\r\n      }\r\n      // Handle serialized Buffer objects\r\n      if (value && typeof value === 'object' && value.type === 'Buffer' && Array.isArray(value.data)) {\r\n        return Buffer.from(value.data);\r\n      }\r\n      throw new Error('Bytes: Invalid value');\r\n    },\r\n    parseValue(value: any) {\r\n      if (Buffer.isBuffer(value)) {\r\n        return value;\r\n      }\r\n      if (value instanceof Uint8Array) {\r\n        return Buffer.from(value);\r\n      }\r\n      // Handle serialized Buffer objects\r\n      if (value && typeof value === 'object' && value.type === 'Buffer' && Array.isArray(value.data)) {\r\n        return Buffer.from(value.data);\r\n      }\r\n      throw new Error('Bytes: Invalid value');\r\n    },\r\n    parseLiteral(ast) {\r\n      throw new Error('Bytes: Literal parsing not supported');\r\n    }\r\n  }),\r\n  \r\n  Query: {\r\n    documents: async () => {\r\n      return await prisma.document.findMany({\r\n        include: {\r\n          owner: true,\r\n          access: {\r\n            include: {\r\n              user: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n    },\r\n\r\n    document: async (_: any, { id }: { id: string }) => {\r\n      return await prisma.document.findUnique({\r\n        where: { id },\r\n        include: {\r\n          owner: true,\r\n          access: {\r\n            include: {\r\n              user: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n    },\r\n\r\n    myDocuments: fetchMyDocuments,\r\n\r\n    sharedDocuments: async (_: any, __: any, context: any) => {\r\n      // TEMPORARY: Allow document listing for testing\r\n      if (!context?.user) {\r\n        console.log(\"No user in context, returning empty shared documents\");\r\n        return []; // Return empty array directly\r\n      }\r\n\r\n      console.log(\"Fetching shared documents for user:\", context.user.id);\r\n\r\n      const documents = await prisma.document.findMany({\r\n        where: {\r\n          access: {\r\n            some: {\r\n              userId: context.user.id,\r\n            },\r\n          },\r\n        },\r\n        include: {\r\n          owner: true,\r\n          access: {\r\n            include: {\r\n              user: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      console.log(\"Returning shared documents array:\", documents);\r\n      return documents; // Return array directly, not wrapped in object\r\n    },\r\n  },\r\n\r\n  Mutation: {\r\n    createDocument: async (\r\n      _: any,\r\n      { title, type }: { title: string; type: string },\r\n      context: any\r\n    ) => {\r\n      console.log(\"=== createDocument called ===\");\r\n      console.log(\"Context received:\", context);\r\n      console.log(\"User in context:\", context?.user);\r\n\r\n      // TEMPORARY: Allow document creation for testing\r\n      if (!context?.user) {\r\n        console.log(\"No user in context, creating document with default user\");\r\n        const defaultUserId = \"cmk1q6rlz00005m8ivwcxc5cy\"; // Your user ID\r\n\r\n        const document = await prisma.document.create({\r\n          data: {\r\n            title,\r\n            type,\r\n            ownerId: defaultUserId,\r\n          },\r\n          include: {\r\n            owner: true,\r\n            access: {\r\n              include: {\r\n                user: true,\r\n              },\r\n            },\r\n          },\r\n        });\r\n\r\n        pubsub.publish(\"DOCUMENT_CREATED\", { documentCreated: document });\r\n        return document;\r\n      }\r\n\r\n      console.log(\"Creating document for user:\", context.user.id);\r\n\r\n      const document = await prisma.document.create({\r\n        data: {\r\n          title,\r\n          type,\r\n          ownerId: context.user.id,\r\n        },\r\n        include: {\r\n          owner: true,\r\n          access: {\r\n            include: {\r\n              user: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      pubsub.publish(\"DOCUMENT_CREATED\", { documentCreated: document });\r\n      return document;\r\n    },\r\n\r\n    updateDocument: async (\r\n      _: any,\r\n      { id, title, content }: { id: string; title?: string; content?: Buffer },\r\n      context: any\r\n    ) => {\r\n      console.log(\"=== updateDocument called ===\");\r\n      console.log(\"Document ID:\", id);\r\n      console.log(\"Context received:\", context);\r\n      console.log(\"User in context:\", context?.user);\r\n\r\n      // TEMPORARY: Allow document updates for testing\r\n      if (!context?.user) {\r\n        console.log(\"No user in context, allowing update for testing\");\r\n        const defaultUserId = \"cmk1q6rlz00005m8ivwcxc5cy\"; // Your user ID\r\n\r\n        const document = await prisma.document.update({\r\n          where: { id },\r\n          data: {\r\n            ...(title && { title }),\r\n            ...(content && { content: Buffer.isBuffer(content) ? content : Buffer.from(content) }),\r\n          },\r\n          include: {\r\n            owner: true,\r\n            access: {\r\n              include: {\r\n                user: true,\r\n              },\r\n            },\r\n          },\r\n        });\r\n\r\n        pubsub.publish(\"DOCUMENT_UPDATED\", { documentUpdated: document });\r\n        return document;\r\n      }\r\n\r\n      console.log(\"Updating document for user:\", context.user.id);\r\n\r\n      const document = await prisma.document.update({\r\n        where: { id },\r\n        data: {\r\n          ...(title && { title }),\r\n          ...(content && { content: Buffer.isBuffer(content) ? content : Buffer.from(content) }),\r\n        },\r\n        include: {\r\n          owner: true,\r\n          access: {\r\n            include: {\r\n              user: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      pubsub.publish(\"DOCUMENT_UPDATED\", { documentUpdated: document });\r\n      return document;\r\n    },\r\n\r\n    deleteDocument: async (_: any, { id }: { id: string }, context: any) => {\r\n      console.log(\"=== deleteDocument called ===\");\r\n      console.log(\"Document ID:\", id);\r\n      console.log(\"Context received:\", context);\r\n      console.log(\"User in context:\", context?.user);\r\n\r\n      // TEMPORARY: Allow document deletion for testing\r\n      if (!context?.user) {\r\n        console.log(\"No user in context, allowing deletion for testing\");\r\n      } else {\r\n        // Check if user owns the document\r\n        const document = await prisma.document.findUnique({\r\n          where: { id },\r\n        });\r\n\r\n        if (!document) {\r\n          throw new Error(\"Document not found\");\r\n        }\r\n\r\n        if (document.ownerId !== context.user.id) {\r\n          throw new Error(\r\n            \"Unauthorized: You can only delete your own documents\"\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log(\"Deleting document:\", id);\r\n\r\n      await prisma.document.delete({\r\n        where: { id },\r\n      });\r\n\r\n      console.log(\"Document deleted successfully\");\r\n      return true;\r\n    },\r\n\r\n    shareDocument: async (\r\n      _: any,\r\n      {\r\n        documentId,\r\n        userId,\r\n        permission,\r\n      }: { documentId: string; userId: string; permission: string },\r\n      context: any\r\n    ) => {\r\n      console.log(\"=== shareDocument called ===\");\r\n      console.log(\"Document ID:\", documentId);\r\n      console.log(\"User ID to share with:\", userId);\r\n      console.log(\"Permission:\", permission);\r\n      console.log(\"Context received:\", context);\r\n      console.log(\"User in context:\", context?.user);\r\n\r\n      // TEMPORARY: Allow document sharing for testing\r\n      if (!context?.user) {\r\n        console.log(\"No user in context, allowing share for testing\");\r\n        const defaultUserId = \"cmk1q6rlz00005m8ivwcxc5cy\"; // Your user ID\r\n\r\n        let storedUserId = userId;\r\n        let mockUser = false;\r\n\r\n        if (userId.includes(\"@\")) {\r\n          const email = userId.trim().toLowerCase();\r\n          const targetUser = await prisma.user.upsert({\r\n            where: { email },\r\n            update: {},\r\n            create: {\r\n              email,\r\n              name: email.split(\"@\")[0],\r\n            },\r\n          });\r\n          storedUserId = targetUser.id;\r\n          mockUser = false;\r\n        }\r\n\r\n        // For testing, use the default user ID instead of the email\r\n        // This ensures the user exists in the database\r\n        const access = await prisma.documentAccess.upsert({\r\n          where: {\r\n            userId_documentId: {\r\n              userId: storedUserId,\r\n              documentId,\r\n            },\r\n          },\r\n          update: {\r\n            permission: permission as any,\r\n          },\r\n          create: {\r\n            documentId,\r\n            userId: storedUserId,\r\n            permission: permission as any,\r\n          },\r\n          include: {\r\n            user: true,\r\n            document: {\r\n              include: {\r\n                owner: true,\r\n              },\r\n            },\r\n          },\r\n        });\r\n\r\n        // Mock the user response to show the email that was \"shared\"\r\n        const mockAccess = mockUser\r\n          ? {\r\n              ...access,\r\n              user: {\r\n                id: userId,\r\n                name: userId.includes(\"@\") ? userId.split(\"@\")[0] : \"Test User\",\r\n                email: userId.includes(\"@\") ? userId : \"test@example.com\",\r\n              },\r\n            }\r\n          : access;\r\n\r\n        pubsub.publish(\"DOCUMENT_SHARED\", { documentShared: mockAccess });\r\n        return mockAccess;\r\n      }\r\n\r\n      console.log(\"Sharing document for user:\", context.user.id);\r\n\r\n      let storedUserId = userId;\r\n\r\n      if (userId.includes(\"@\")) {\r\n        const email = userId.trim().toLowerCase();\r\n        const targetUser = await prisma.user.upsert({\r\n          where: { email },\r\n          update: {},\r\n          create: {\r\n            email,\r\n            name: email.split(\"@\")[0],\r\n          },\r\n        });\r\n        storedUserId = targetUser.id;\r\n      }\r\n\r\n      const access = await prisma.documentAccess.upsert({\r\n        where: {\r\n          userId_documentId: {\r\n            userId: storedUserId,\r\n            documentId,\r\n          },\r\n        },\r\n        update: {\r\n          permission: permission as any,\r\n        },\r\n        create: {\r\n          documentId,\r\n          userId: storedUserId,\r\n          permission: permission as any,\r\n        },\r\n        include: {\r\n          user: true,\r\n          document: {\r\n            include: {\r\n              owner: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      pubsub.publish(\"DOCUMENT_SHARED\", { documentShared: access });\r\n      return access;\r\n    },\r\n\r\n    revokeAccess: async (\r\n      _: any,\r\n      { documentId, userId }: { documentId: string; userId: string },\r\n      context: any\r\n    ) => {\r\n      console.log(\"=== revokeAccess called ===\");\r\n      console.log(\"Document ID:\", documentId);\r\n      console.log(\"User ID to revoke:\", userId);\r\n      console.log(\"Context received:\", context);\r\n      console.log(\"User in context:\", context?.user);\r\n\r\n      // TEMPORARY: Allow access revocation for testing\r\n      if (!context?.user) {\r\n        console.log(\"No user in context, allowing revoke for testing\");\r\n        // For testing, we need to use the actual user ID that was stored in the database\r\n        // Since we're using the default user ID for sharing, we need to revoke that same ID\r\n        const defaultUserId = \"cmk1q6rlz00005m8ivwcxc5cy\";\r\n\r\n        let storedUserId = userId;\r\n\r\n        if (userId.includes(\"@\")) {\r\n          const targetUser = await prisma.user.findUnique({\r\n            where: { email: userId },\r\n          });\r\n          storedUserId = targetUser?.id || defaultUserId;\r\n        }\r\n\r\n        try {\r\n          await prisma.documentAccess.delete({\r\n            where: {\r\n              userId_documentId: {\r\n                // Correct field name\r\n                userId: storedUserId, // Use the actual stored user ID\r\n                documentId,\r\n              },\r\n            },\r\n          });\r\n\r\n          console.log(\"Access revoked successfully\");\r\n          return true;\r\n        } catch (error) {\r\n          console.error(\"Error revoking access:\", error);\r\n          // Return true anyway for UI purposes\r\n          return true;\r\n        }\r\n      }\r\n\r\n      console.log(\"Revoking access for user:\", userId);\r\n\r\n      let storedUserId = userId;\r\n\r\n      if (userId.includes(\"@\")) {\r\n        const email = userId.trim().toLowerCase();\r\n        const targetUser = await prisma.user.findUnique({ where: { email } });\r\n        if (!targetUser) {\r\n          throw new Error(\"User not found\");\r\n        }\r\n        storedUserId = targetUser.id;\r\n      }\r\n\r\n      try {\r\n        await prisma.documentAccess.delete({\r\n          where: {\r\n            userId_documentId: {\r\n              userId: storedUserId,\r\n              documentId,\r\n            },\r\n          },\r\n        });\r\n\r\n        console.log(\"Access revoked successfully\");\r\n        return true;\r\n      } catch (error) {\r\n        console.error(\"Error revoking access:\", error);\r\n        throw new Error(\"Failed to revoke access\");\r\n      }\r\n    },\r\n  },\r\n\r\n  Subscription: {\r\n    documentUpdated: {\r\n      subscribe: (_: any, { documentId }: { documentId: string }) => {\r\n        return (pubsub as any).asyncIterator([\r\n          `DOCUMENT_UPDATED_${documentId}`,\r\n        ]);\r\n      },\r\n    },\r\n    documentShared: {\r\n      subscribe: (_: any, { documentId }: { documentId: string }) => {\r\n        return (pubsub as any).asyncIterator([`DOCUMENT_SHARED_${documentId}`]);\r\n      },\r\n    },\r\n  },\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 666, "column": 0}, "map": {"version":3,"sources":["file:///E:/wark/Next.graphQL/nextTyar/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 679, "column": 0}, "map": {"version":3,"sources":["file:///E:/wark/Next.graphQL/nextTyar/src/lib/graphql/server.ts"],"sourcesContent":["import { ApolloServer } from \"@apollo/server\";\r\nimport { startServerAndCreateNextHandler } from \"@as-integrations/next\";\r\nimport { typeDefs } from \"./schema\";\r\nimport { resolvers } from \"./resolvers\";\r\nimport { getToken } from \"next-auth/jwt\";\r\nimport { prisma } from \"../prisma\";\r\n\r\nexport const server = new ApolloServer({\r\n  typeDefs,\r\n  resolvers,\r\n});\r\n\r\nexport const handler = startServerAndCreateNextHandler(server, {\r\n  context: async (req: any) => {\r\n    console.log(\"=== GraphQL Context Debug ===\");\r\n    console.log(\"Request method:\", req.method);\r\n    console.log(\"Request URL:\", req.url);\r\n    console.log(\"Request headers:\", req.headers);\r\n    console.log(\"Request cookies:\", req.cookies);\r\n\r\n    // Try to get token from multiple sources\r\n    let token = null;\r\n    let session = null;\r\n\r\n    try {\r\n      // Method 1: Try x-user-id header (our custom header)\r\n      if (req.headers?.[\"x-user-id\"]) {\r\n        console.log(\"Found x-user-id header:\", req.headers[\"x-user-id\"]);\r\n        // Create a minimal session object\r\n        session = {\r\n          user: {\r\n            id: req.headers[\"x-user-id\"],\r\n            email: \"user@example.com\",\r\n            name: \"User\",\r\n          },\r\n        };\r\n        console.log(\"Created session from x-user-id:\", session);\r\n      }\r\n\r\n      // Method 2: Try JWT token from cookies\r\n      if (!session && req.cookies?.[\"next-auth.session-token\"]) {\r\n        console.log(\r\n          \"Found session token in cookies:\",\r\n          req.cookies[\"next-auth.session-token\"]\r\n        );\r\n        token = await getToken({\r\n          req,\r\n          secret: process.env.NEXTAUTH_SECRET,\r\n          cookieName: \"next-auth.session-token\",\r\n        });\r\n        console.log(\"Token from cookies:\", token);\r\n\r\n        if (token) {\r\n          session = {\r\n            user: {\r\n              id: token.id,\r\n              email: token.email,\r\n              name: token.name,\r\n            },\r\n          };\r\n        }\r\n      }\r\n\r\n      // Method 3: Try authorization header\r\n      if (!session && req.headers?.authorization) {\r\n        const authHeader = req.headers.authorization;\r\n        console.log(\"Found auth header:\", authHeader);\r\n        if (authHeader.startsWith(\"Bearer \")) {\r\n          token = await getToken({\r\n            req: {\r\n              ...req,\r\n              headers: {\r\n                ...req.headers,\r\n                cookie: `next-auth.session-token=${authHeader.substring(7)}`,\r\n              },\r\n            } as any,\r\n            secret: process.env.NEXTAUTH_SECRET,\r\n          });\r\n          console.log(\"Token from auth header:\", token);\r\n\r\n          if (token) {\r\n            session = {\r\n              user: {\r\n                id: token.id,\r\n                email: token.email,\r\n                name: token.name,\r\n              },\r\n            };\r\n          }\r\n        }\r\n      }\r\n\r\n      console.log(\"Final session:\", session);\r\n      console.log(\"=== End Debug ===\");\r\n    } catch (error) {\r\n      console.error(\"Session retrieval error:\", error);\r\n    }\r\n\r\n    return {\r\n      user: session?.user || null,\r\n      prisma,\r\n    };\r\n  },\r\n});\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,MAAM,SAAS,IAAI,mLAAY,CAAC;IACrC,UAAA,6IAAQ;IACR,WAAA,iJAAS;AACX;AAEO,MAAM,UAAU,IAAA,kMAA+B,EAAC,QAAQ;IAC7D,SAAS,OAAO;QACd,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,mBAAmB,IAAI,MAAM;QACzC,QAAQ,GAAG,CAAC,gBAAgB,IAAI,GAAG;QACnC,QAAQ,GAAG,CAAC,oBAAoB,IAAI,OAAO;QAC3C,QAAQ,GAAG,CAAC,oBAAoB,IAAI,OAAO;QAE3C,yCAAyC;QACzC,IAAI,QAAQ;QACZ,IAAI,UAAU;QAEd,IAAI;YACF,qDAAqD;YACrD,IAAI,IAAI,OAAO,EAAE,CAAC,YAAY,EAAE;gBAC9B,QAAQ,GAAG,CAAC,2BAA2B,IAAI,OAAO,CAAC,YAAY;gBAC/D,kCAAkC;gBAClC,UAAU;oBACR,MAAM;wBACJ,IAAI,IAAI,OAAO,CAAC,YAAY;wBAC5B,OAAO;wBACP,MAAM;oBACR;gBACF;gBACA,QAAQ,GAAG,CAAC,mCAAmC;YACjD;YAEA,uCAAuC;YACvC,IAAI,CAAC,WAAW,IAAI,OAAO,EAAE,CAAC,0BAA0B,EAAE;gBACxD,QAAQ,GAAG,CACT,mCACA,IAAI,OAAO,CAAC,0BAA0B;gBAExC,QAAQ,MAAM,IAAA,0JAAQ,EAAC;oBACrB;oBACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;oBACnC,YAAY;gBACd;gBACA,QAAQ,GAAG,CAAC,uBAAuB;gBAEnC,IAAI,OAAO;oBACT,UAAU;wBACR,MAAM;4BACJ,IAAI,MAAM,EAAE;4BACZ,OAAO,MAAM,KAAK;4BAClB,MAAM,MAAM,IAAI;wBAClB;oBACF;gBACF;YACF;YAEA,qCAAqC;YACrC,IAAI,CAAC,WAAW,IAAI,OAAO,EAAE,eAAe;gBAC1C,MAAM,aAAa,IAAI,OAAO,CAAC,aAAa;gBAC5C,QAAQ,GAAG,CAAC,sBAAsB;gBAClC,IAAI,WAAW,UAAU,CAAC,YAAY;oBACpC,QAAQ,MAAM,IAAA,0JAAQ,EAAC;wBACrB,KAAK;4BACH,GAAG,GAAG;4BACN,SAAS;gCACP,GAAG,IAAI,OAAO;gCACd,QAAQ,CAAC,wBAAwB,EAAE,WAAW,SAAS,CAAC,IAAI;4BAC9D;wBACF;wBACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;oBACrC;oBACA,QAAQ,GAAG,CAAC,2BAA2B;oBAEvC,IAAI,OAAO;wBACT,UAAU;4BACR,MAAM;gCACJ,IAAI,MAAM,EAAE;gCACZ,OAAO,MAAM,KAAK;gCAClB,MAAM,MAAM,IAAI;4BAClB;wBACF;oBACF;gBACF;YACF;YAEA,QAAQ,GAAG,CAAC,kBAAkB;YAC9B,QAAQ,GAAG,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;QAC5C;QAEA,OAAO;YACL,MAAM,SAAS,QAAQ;YACvB,QAAA,gIAAM;QACR;IACF;AACF"}},
    {"offset": {"line": 787, "column": 0}, "map": {"version":3,"sources":["file:///E:/wark/Next.graphQL/nextTyar/src/app/api/graphql/route.ts"],"sourcesContent":["import { handler } from \"@/lib/graphql/server\";\r\n\r\nexport async function GET(request: Request) {\r\n  console.log(\"=== GraphQL API GET ===\");\r\n  console.log(\"Request URL:\", request.url);\r\n  console.log(\r\n    \"Request headers:\",\r\n    Object.fromEntries(request.headers.entries())\r\n  );\r\n  return handler(request);\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  console.log(\"=== GraphQL API POST ===\");\r\n  console.log(\"Request URL:\", request.url);\r\n  console.log(\r\n    \"Request headers:\",\r\n    Object.fromEntries(request.headers.entries())\r\n  );\r\n  return handler(request);\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe,IAAI,OAAgB;IACxC,QAAQ,GAAG,CAAC;IACZ,QAAQ,GAAG,CAAC,gBAAgB,QAAQ,GAAG;IACvC,QAAQ,GAAG,CACT,oBACA,OAAO,WAAW,CAAC,QAAQ,OAAO,CAAC,OAAO;IAE5C,OAAO,IAAA,4IAAO,EAAC;AACjB;AAEO,eAAe,KAAK,OAAgB;IACzC,QAAQ,GAAG,CAAC;IACZ,QAAQ,GAAG,CAAC,gBAAgB,QAAQ,GAAG;IACvC,QAAQ,GAAG,CACT,oBACA,OAAO,WAAW,CAAC,QAAQ,OAAO,CAAC,OAAO;IAE5C,OAAO,IAAA,4IAAO,EAAC;AACjB"}}]
}